{
  "id" : "6911948b13c1403c985200ea",
  "cts" : 1762759817938,
  "createdUserName" : "Akshatha SM",
  "modifiedUserName" : "divakar v",
  "mts" : 1762851037230,
  "createdBy" : "67c562eba649de63bf3835e4",
  "modifiedBy" : "63cf749921c7bb55c7368952",
  "proxyId" : "690c661d6952e12772f00426",
  "revision" : 2,
  "name" : "UsersList",
  "description" : "UsersList",
  "apiType" : "RESTAPI",
  "apiMethod" : "GET",
  "path" : "/userslist",
  "pathArray" : [ "userslist" ],
  "revisionStatus" : "REVIEW",
  "locked" : true,
  "lockedBy" : "divakar v",
  "nodeDataHashMap" : {
    "inbound" : {
      "e2eb696a-b1f4-409d-9c08-181cfe1e96c0" : [ "v1" ],
      "bf128fc5-83e0-4743-85fa-2c837f6af620" : [ "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c" ],
      "f70b0ad6-a03d-4132-9e57-ec9cfe557108" : [ "bf128fc5-83e0-4743-85fa-2c837f6af620" ],
      "3b595ed2-893a-45f6-877e-bc15ac57c6ef" : [ "e2eb696a-b1f4-409d-9c08-181cfe1e96c0" ],
      "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c" : [ "3b595ed2-893a-45f6-877e-bc15ac57c6ef" ]
    },
    "outbound" : {
      "v1" : [ "e2eb696a-b1f4-409d-9c08-181cfe1e96c0" ],
      "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c" : [ "bf128fc5-83e0-4743-85fa-2c837f6af620" ],
      "bf128fc5-83e0-4743-85fa-2c837f6af620" : [ "f70b0ad6-a03d-4132-9e57-ec9cfe557108" ],
      "e2eb696a-b1f4-409d-9c08-181cfe1e96c0" : [ "3b595ed2-893a-45f6-877e-bc15ac57c6ef" ],
      "3b595ed2-893a-45f6-877e-bc15ac57c6ef" : [ "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c" ]
    },
    "allNeighbours" : [ "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c", "e2eb696a-b1f4-409d-9c08-181cfe1e96c0", "3b595ed2-893a-45f6-877e-bc15ac57c6ef", "v1", "f70b0ad6-a03d-4132-9e57-ec9cfe557108", "bf128fc5-83e0-4743-85fa-2c837f6af620" ]
  },
  "vertexHashMap" : {
    "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c" : {
      "vertexId" : "cfccbe0a-e8ba-4ef6-a940-57a152d9d29c",
      "vertexType" : "JAVASCRIPT",
      "name" : "javascript-Userslist",
      "description" : "javascript-Userslist",
      "javascriptData" : {
        "targetVariable" : "data",
        "variableDataType" : "STRING",
        "javascript" : "var execute = function (input) {\n  console.log(\"Raw input:\", JSON.stringify(input, null, 2));\n\n  // Validate structure\n  if (!input || !Array.isArray(input.data) || input.data.length === 0) {\n    return '<p>No user data available</p>';\n  }\n\n  var users = input.data || [];\n  var teams = input.teams || [];\n  var userMap = {}; // key = email, value = aggregated user info\n\n  // Helper to format timestamps\n  function formatDate(timestamp) {\n    if (!timestamp) return '-';\n    var d = new Date(timestamp);\n    return d.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });\n  }\n\n  // Step 1: Process users\n  users.forEach(function (user) {\n    var email = user.email || '';\n    if (!email) return;\n\n    var userId = user.loginId || '';\n    if (!userId) return; // skip users without userId\n\n    var fullName = ((user.firstName || '') + ' ' + (user.lastName || '')).trim();\n    var userEntry = userMap[email] || {\n      name: fullName,\n      userId: userId,\n      createdOn: formatDate(user.cts),\n      status: user.userStatus || '-',\n      lastModified: formatDate(user.mts),\n      lastLogin: formatDate(user.latestLoginTimestamp),\n      roles: [],\n      teams: []\n    };\n\n    (user.workspaces || []).forEach(function (ws) {\n      (ws.roles || []).forEach(function (role) {\n        if (userEntry.roles.indexOf(role) === -1) {\n          userEntry.roles.push(role);\n        }\n      });\n    });\n\n    userMap[email] = userEntry;\n  });\n\n  // Step 2: Match users to teams\n  teams.forEach(function (team) {\n    (team.contacts || []).forEach(function (contact) {\n      var email = contact.email || '';\n      if (email && userMap[email]) {\n        if (userMap[email].teams.indexOf(team.displayName || team.name) === -1) {\n          userMap[email].teams.push(team.displayName || team.name);\n        }\n\n        // Merge contact roles\n        (contact.role || []).forEach(function (r) {\n          if (userMap[email].roles.indexOf(r) === -1) {\n            userMap[email].roles.push(r);\n          }\n        });\n      }\n    });\n  });\n\n  console.log(\"Processed userMap:\", JSON.stringify(userMap, null, 2));\n\n  // Step 3: Build HTML (without workspace column)\n  var rows = '';\n  for (var email in userMap) {\n    var u = userMap[email];\n    rows +=\n      '<tr>' +\n      '<td>' + u.name + '</td>' +\n      '<td>' + u.userId + '</td>' +\n      '<td>' + email + '</td>' +\n      '<td>' + u.teams.join(', ') + '</td>' +\n      '<td>' + u.roles.join(', ') + '</td>' +\n      '<td>' + u.status + '</td>' +\n      '<td>' + u.createdOn + '</td>' +\n      '<td>' + u.lastModified + '</td>' +\n      '<td>' + u.lastLogin + '</td>' +\n      '</tr>';\n  }\n\n  return (\n    '<table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" ' +\n    'style=\"border-collapse: collapse; width: 100%; font-family: Arial, sans-serif;\">' +\n    '<thead>' +\n    '<tr style=\"background-color: #f4f4f4;\">' +\n    '<th>Name</th>' +\n    '<th>User ID</th>' +\n    '<th>Email</th>' +\n    '<th>Teams</th>' +\n    '<th>Roles</th>' +\n    '<th>Status</th>' +\n    '<th>Created On</th>' +\n    '<th>Last Modified</th>' +\n    '<th>Last Login</th>' +\n    '</tr>' +\n    '</thead>' +\n    '<tbody>' +\n    (rows || '<tr><td colspan=\"9\">No data available</td></tr>') +\n    '</tbody>' +\n    '</table>'\n  );\n};\n",
        "variables" : {
          "data" : "{{{data}}}",
          "teams" : "{{{teams}}}"
        },
        "skip" : false,
        "showActualErrorMessage" : false,
        "continueOnError" : false,
        "errorResponse" : {
          "statusCode" : 400,
          "body" : {
            "data" : "",
            "type" : "json"
          }
        },
        "customResponseMapping" : false,
        "responsePathMapping" : { }
      },
      "imported" : false,
      "skipRuntimeVariables" : false
    },
    "e2eb696a-b1f4-409d-9c08-181cfe1e96c0" : {
      "vertexId" : "e2eb696a-b1f4-409d-9c08-181cfe1e96c0",
      "vertexType" : "DATABASE",
      "name" : "AGG",
      "description" : "./",
      "databaseData" : {
        "connectorId" : "68b839a4399db1665a31dccd",
        "databaseType" : "MONGODB",
        "query" : "{\"operation\":\"aggregate\",\"databaseName\":\"apiwiz-stage\",\"collection\":\"Users.List\",\"documents\":[{\"$match\":{\"workspaces.workspace._id\":\"qa-dev\"}},{\"$lookup\":{\"from\":\"Users.Sessions.List\",\"let\":{\"userId\":{\"$toString\":\"$_d\"}},\"pipeline\":[{\"$match\":{\"$expr\":{\"$eq\":[\"$userId\",\"$$serId\"]}}},{\"$sort\":{\"loginTimestamp\":-1}},{\"$limit\":1},{\"$project\":{\"loginTimestamp\":1,\"_id\":0}}],\"as\":\"latestSession\"}},{\"$unwind\":{\"path\":\"$latestSession\",\"preserveNullAndEmptyArrays\":true}},{\"$addFields\":{\"latestLoginTimestamp\":\"$latestSession.loginTimestamp\"}},{\"$unset\":[\"latestSession\",\"profileImage\"]}],\"updates\":[],\"pipelines\":[{\"$match\":{\"workspaces.workspace._id\":\"qa-dev\"}},{\"$lookup\":{\"from\":\"Users.Sessions.List\",\"let\":{\"userId\":{\"$toString\":\"$_id\"}},\"pipeline\":[{\"$match\":{\"$expr\":{\"$eq\":[\"$userId\",\"$$userId\"]}}},{\"$sort\":{\"loginTimestamp\":-1}},{\"$limit\":1},{\"$project\":{\"loginTimestamp\":1,\"_id\":0}}],\"as\":\"latestSession\"}},{\"$unwind\":{\"path\":\"$latestSession\",\"preserveNullAndEmptyArrays\":true}},{\"$addFields\":{\"latestLoginTimestamp\":\"$latestSession.loginTimestamp\"}},{\"$unset\":[\"latestSession\",\"profileImage\"]}],\"deletes\":[],\"filter\":{},\"projection\":{},\"sort\":{},\"limit\":0,\"skip\":0}",
        "variableName" : "data",
        "connectorName" : "Stage-DB",
        "tenantName" : "apiwiz-stage",
        "collectionName" : "Users.List",
        "skip" : false,
        "showActualErrorMessage" : false
      },
      "imported" : false,
      "skipRuntimeVariables" : false
    },
    "3b595ed2-893a-45f6-877e-bc15ac57c6ef" : {
      "vertexId" : "3b595ed2-893a-45f6-877e-bc15ac57c6ef",
      "vertexType" : "DATABASE",
      "name" : "getTeamsFromTenantDB",
      "description" : "Collecting teams to integrate in the final users list.",
      "databaseData" : {
        "connectorId" : "68b839a4399db1665a31dccd",
        "databaseType" : "MONGODB",
        "query" : "{\"operation\":\"find\",\"databaseName\":\"qa-dev\",\"collection\":\"Design.Swagger.Teams\",\"documents\":[{\"_id\":\"\",\"name\":\"\",\"displayName\":\"\",\"description\":\"\",\"contacts\":[{\"name\":\"\",\"email\":\"\",\"role\":[]}],\"swaggers\":\"\",\"swagger3\":[],\"cts\":\"\",\"createdUserName\":\"\",\"modifiedUserName\":\"\",\"mts\":\"\",\"createdBy\":\"\",\"modifiedBy\":\"\",\"interactionid\":\"\",\"_class\":\"\"}],\"updates\":[],\"pipelines\":[{\"$match\":{\"status\":\"TESTED\"}},{\"$facet\":{\"deploymentFacet\":[{\"$group\":{\"_id\":\"$deploymentAccess.name\",\"count\":{\"$sum\":1}}},{\"$sort\":{\"count\":-1}},{\"$limit\":5}],\"tlsSettingsFacet\":[{\"$group\":{\"_id\":\"$tlsSettings.tlsMode\",\"totalCertificates\":{\"$sum\":1},\"avgPort\":{\"$avg\":\"$port\"}}}],\"statusHistoryFacet\":[{\"$unwind\":\"$statusHistory\"},{\"$group\":{\"_id\":\"$statusHistory.status\",\"count\":{\"$sum\":1}}}]}},{\"$project\":{\"deploymentFacet\":1,\"tlsSettingsFacet\":1,\"statusHistoryFacet\":1}}],\"deletes\":[],\"filter\":{},\"projection\":{},\"sort\":{},\"limit\":0,\"skip\":0}",
        "variableName" : "teams",
        "connectorName" : "Stage-DB",
        "tenantName" : "qa-dev",
        "collectionName" : "Design.Swagger.Teams",
        "skip" : false,
        "showActualErrorMessage" : false
      },
      "imported" : false,
      "skipRuntimeVariables" : false
    },
    "v1" : {
      "vertexId" : "v1",
      "vertexType" : "START",
      "name" : "Request",
      "requestVariables" : [ ],
      "mandatoryHeaders" : [ ],
      "mandatoryQueryParams" : [ ],
      "imported" : true,
      "skipRuntimeVariables" : false,
      "securityResponse" : {
        "isEnabled" : false,
        "skip" : false,
        "showActualErrorMessage" : false,
        "continueOnError" : false,
        "errorResponse" : {
          "statusCode" : 400,
          "headers" : {
            "a" : "a"
          },
          "body" : {
            "data" : "",
            "type" : "json"
          }
        }
      }
    },
    "f70b0ad6-a03d-4132-9e57-ec9cfe557108" : {
      "vertexId" : "f70b0ad6-a03d-4132-9e57-ec9cfe557108",
      "vertexType" : "STOP",
      "name" : "Stop",
      "imported" : false,
      "skipRuntimeVariables" : false,
      "proxyResponse" : {
        "statusCode" : 200,
        "headers" : {
          "content-type" : "application/json"
        },
        "body" : {
          "data" : "{{{message}}}",
          "type" : "json"
        }
      }
    },
    "bf128fc5-83e0-4743-85fa-2c837f6af620" : {
      "vertexId" : "bf128fc5-83e0-4743-85fa-2c837f6af620",
      "vertexType" : "EMAIL_CONNECTOR",
      "name" : "NewEmail",
      "description" : "NewEmail",
      "mailConnectorData" : {
        "mailTemplate" : {
          "toMailIds" : [ "chinmayee.jagadeesh@apiwiz.com", "madhusudan@apiwiz.com" ],
          "body" : "<p>{{{data}}}</p>\n",
          "subject" : "Users List ",
          "rtfValue" : "{{{data}}}"
        },
        "mailProperty" : {
          "tenantId" : "682b543c5de5a802d2d201be",
          "mailPort" : "587",
          "mailHost" : "smtp.gmail.com",
          "smtpAuth" : true,
          "userName" : "engineering@apiwiz.com ",
          "password" : "aeL7IusJOi39zl6ciz1cZMHY2LyHPeDdUtmgr6vycSNQtDDH0k8dAPZG0hTToUXOoWUOPjcoVFfC9gQfy9170N48/fnLdbftsi2W6lcQg50QM9MFNT8MwBhaSkxGN/8q+LfFYY3jw9qul6XTksNnpzTRI8+PHF1hsPg4/M7f9Sl3ggd4zj77AoOtrtBIjZqwcU1viH7nsIho7Uc7iInAvX1Ci5HZ0fIihE4NLIPwhKYLCRiSVkhW37w5U7TjHtPPSzuVVBVcVMdY0Oic0yKEC2DYTQlcK72MnDLubghlTYCWT5foQ5Y5bZ6UYCtdrRqNLqiQXgmeGgKpDJDJRdSx2w==",
          "connectionTimeOut" : 5000,
          "timeOut" : 5000,
          "writeTimeOut" : 5000,
          "enableStartTLS" : true,
          "mailFromAddress" : "engineering@apiwiz.com ",
          "cts" : 1747670076067,
          "mts" : 1757660032907,
          "createdBy" : "67e298cbed1ae94ac870b921",
          "modifiedBy" : "67c562eba649de63bf3835e4",
          "createdUserName" : "Akshatha sm",
          "modifiedUserName" : "Akshatha SM"
        },
        "skip" : false,
        "showActualErrorMessage" : false,
        "continueOnError" : false,
        "errorResponse" : {
          "statusCode" : 400,
          "body" : {
            "data" : "",
            "type" : "json"
          }
        }
      },
      "imported" : false,
      "skipRuntimeVariables" : false
    }
  },
  "statusHistory" : [ {
    "status" : "Review",
    "cts" : 1762850944859,
    "lastModifiedBy" : "63cf749921c7bb55c7368952",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762850884782,
    "lastModifiedBy" : "63cf749921c7bb55c7368952",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762850837646,
    "lastModifiedBy" : "63cf749921c7bb55c7368952",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762850599779,
    "lastModifiedBy" : "63cf749921c7bb55c7368952",
    "description" : ",."
  }, {
    "status" : "Review",
    "cts" : 1762850580883,
    "lastModifiedBy" : "63cf749921c7bb55c7368952",
    "description" : "./"
  }, {
    "status" : "Approved",
    "cts" : 1762838694063,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762838165631,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762837444879,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762837400200,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762837170335,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762837127938,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Approved",
    "cts" : 1762837121535,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Approved",
    "cts" : 1762836987196,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762836925443,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762834713803,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "./"
  }, {
    "status" : "Review",
    "cts" : 1762777968954,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762760271120,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "das"
  }, {
    "status" : "Review",
    "cts" : 1762760215008,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "Proxy undeploy"
  }, {
    "status" : "Approved",
    "cts" : 1762759827495,
    "lastModifiedBy" : "67c562eba649de63bf3835e4",
    "description" : "a"
  }, {
    "status" : "Draft",
    "cts" : 1762759817938,
    "lastModifiedBy" : "Akshatha SM",
    "description" : "Created new proxy revision"
  } ],
  "virtualHostList" : [ ],
  "enableTracing" : false,
  "environmentName" : "",
  "environmentId" : "",
  "selectedVirtualHostName" : "",
  "selectedVirtualHostId" : "",
  "kafkaConnectorId" : "",
  "kafkaTopic" : "",
  "kafkaGroupId" : "",
  "enableLogging" : false,
  "deleted" : false,
  "deployed" : false
}